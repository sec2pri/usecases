---
title: "Secondary HGNC Symbols used in different Databases"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

This script compares gene symbol names from four different databases (KEGG, Reactome, WikiPathways, Gene Ontology) to the list of outdated HGNC symbols.

## 0. Notebook setup
The first section of this Notebook lists all the libraries required to run this script.

```{r}
#Package manager:
if(!requireNamespace("BiocManager", quietly = TRUE)) install.packages("BiocManager",repos = "http://cran.us.r-project.org")
#Package for path variable
if(!"rstudioapi" %in% installed.packages()) BiocManager::install("rstudioapi")
#Libraries required for markdown documents:
if(!"markdown" %in% installed.packages()){install.packages("markdown")}
if(!"rmarkdown" %in% installed.packages()){install.packages("rmarkdown")}

#load libraries
library(rstudioapi)

# set working environment to current folder
workingDirectory <- setwd(dirname(rstudioapi::getSourceEditorContext()$path))
```

## 1. HGNC Symbol data download
First, we load all the secondary symbols of HGNC to be used in this comparison.
We filter out the symbols which are used as both primary and secondary symbols.

```{r}
plot(cars)
```

## 2. Data Download
We download the data for each database, based on their API or RDF (depending on availability).

### 1. KEGG

### 2. Reactome

```{r}
##Reactome

###PRIOR code to install SPARQl package; Package not available in CRAN anymore, only works for older version of R
#if(!"SPARQL" %in% installed.packages()){
#  install.packages("SPARQL")
#}

##Solution: download from archived version
#Location to install archived packages:
packageFolder <-paste0(workingDirectory, '/packages/SPARQL.tar.gz')
downloadLinkSPARQL <-"https://cran.r-project.org/src/contrib/Archive/SPARQL/SPARQL_1.16.tar.gz"

##Download archived version instead:
if(!"downloader" %in% installed.packages()){
  install.packages("downloader")
}
library("downloader")

##Only download file if needed
if (!file.exists(packageFolder)) {
  download.file(downloadLinkSPARQL, packageFolder)
}

##Install the local version of the library
install.packages(packageFolder, repos = NULL, type="source")

library(SPARQL)
##Connect to Endpoint WikiPathways
endpointwp <- "https://sparql.wikipathways.org/sparql"

## 1. Query metadata:
queryMetadata <-
"SELECT DISTINCT ?dataset (str(?titleLit) as ?title) ?date ?license 
WHERE {
   ?dataset a void:Dataset ;
   dcterms:title ?titleLit ;
   dcterms:license ?license ;
   pav:createdOn ?date .
 }"
 #below code should be performed first to handle the ssl certificate error
options(RCurlOptions = list(cainfo = paste0( tempdir() , "/cacert.pem" ), ssl.verifypeer = FALSE))
resultsMetadata <- SPARQL(endpointwp,queryMetadata,curl_args=list(useragent=R.version.string))
showresultsMetadata <- resultsMetadata$results
remove(queryMetadata, resultsMetadata)

## 2. Query Reactome PWs, through HGNC symbols:
queryReactome <-
"PREFIX cur:            <http://vocabularies.wikipathways.org/wp#Curation:> #to differentiate between Reactome and WP PWs.

select distinct (fn:substring(?hgncId,37) as ?HGNC) (GROUP_CONCAT(DISTINCT str(?wpid);separator=', ') AS ?pathways)  (COUNT(DISTINCT str(?wpid)) AS ?usage)
where {
  ?pathwayRes a wp:Pathway ;                   #Define what is a pathway
              wp:organismName 'Homo sapiens' ; #Filter pathways on species Human
              dcterms:identifier ?wpid ;       #Obtain identifier of pathway
              wp:ontologyTag cur:Reactome_Approved .  #Reactome: Reactome_Approved . WP: Curation:AnalysisCollection
  
  ?protein wp:bdbHgncSymbol ?hgncId ;          #Find proteins based on HGNC symbol
           dcterms:isPartOf ?pathwayRes .      #Connect protein to PW
}
ORDER BY DESC (?usage)
"
##Execute query:
resultsReactome <- SPARQL(endpointwp,queryReactome,curl_args=list(useragent=R.version.string))
showresultsReactome <- resultsReactome$results
remove(queryReactome, resultsReactome)
```


### 3. WikiPathways

### 4. Gene Ontology

From the Quick-GO website (https://www.ebi.ac.uk/QuickGO/), we downloaded data based on the following criteria:
I. Taxon: 9606 (Homo sapiens, human).
II. Gene product type: Proteins, Reviewed (Swiss-Prot), all settings for Proteomes.

Data was downloaded on: 1st of August, with 5199 annotations, as a TSV file.
```{r}
# Obtain Working Directory to find data
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
getwd()
setwd('..')
work_DIR <- getwd()

##GO terms
go_terms <- read.delim(file = "Data/QuickGO-annotations-1659356807403-20220801.tsv", header = TRUE, sep = '\t')
go_terms_unique <- unique(go_terms$SYMBOL)

# Set Working Directory back to current folder
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
work_DIR <- getwd()

```

## 3. Data Comparison
We compare the data for each database to the secondary HGNC symbols.

```{r}
plot(cars)
```

## 4. Data Visualization
We visualize the data for all databases combined.

```{r}
plot(cars)
```
